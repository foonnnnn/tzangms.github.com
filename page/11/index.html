
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Oceanic / 人生海海</title>
  <meta name="author" content="tzangms">

  
  <meta name="description" content="現在有自己的 django project 在 running 的好處就是可以隨便試一些東西, 昨天晚上看到了 Johnny Cache 這篇文章, 馬上就用 pip 裝了起來, 裝上 stickeraction, 儘管原本對 loading 最重的部份都已經用了 memcache 做處理, ...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tzangms.com/page/11/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/tzangms" rel="alternate" title="Oceanic / 人生海海" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><hgroup>
  <img src="/images/logo.png"/>
  <!--
  <h1><a href="/">Oceanic / 人生海海</a></h1>
  
    <h2>這就是人生阿</h2>
  
  -->
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/tzangms" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tzangms.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/about/">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/programming/2573">[Django] Johnny Cache</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-03-02T11:32:37+08:00" pubdate  data-updated="true" >Mar 2<span>nd</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>現在有自己的 <a href="http://www.djangoproject.com/">django</a> project 在 running 的好處就是可以隨便試一些東西, 昨天晚上看到了 <a href="http://django.jmoiron.net/blog/johnny-cache/">Johnny Cache</a> 這篇文章, 馬上就用 pip 裝了起來, 裝上 <a href="http://stickeraction.com">stickeraction</a>, 儘管原本對 loading 最重的部份都已經用了 memcache 做處理, 沒想到 mysql queries 馬上就往下掉。</p>

<p><a href="http://tzangms.com/wp-content/uploads/2010/03/localhost.localdomain-mysql_queries-day.png"><img src="http://tzangms.com/wp-content/uploads/2010/03/localhost.localdomain-mysql_queries-day.png" alt="" title="localhost.localdomain-mysql_queries-day" width="495" height="343" class="aligncenter size-full wp-image-2574" /></a></p>

<p>不過其實我還沒去看他的作法 XD 反正他都說有在 production 跑了 (笑)</p>

<p>Anyway, 基本上他的作法主要還是對 queryset 做 cache, 其實先前 pownce 的 mmalone 就有<a href="http://github.com/mmalone/django-caching">寫了 queryset caching 的 example app</a>, 只是裝上之後得換掉 ModelManager, 有點麻煩, 而 johnny cache 的作法僅是在 settings.py 裡面加進幾行而已, transparent 得多了, <a href="http://django.jmoiron.net/blog/johnny-cache/">Johnny Cache</a> 這篇文章的 comments 裡面也有提到另一個 <a href="http://github.com/jbalogh/django-cache-machine">django-cache-machine</a>。</p>

<p>不過雖然 mysql 的 loading 往下掉, 可是 context switches 跟 interrupts 還有 cpu 都往上飆勒, 在多跑幾天看看。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/web/2572">一起來貼&#8221;我討厭網誌音樂自動播放&#8221;的串連貼紙吧!</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-03-01T22:26:17+08:00" pubdate  data-updated="true" >Mar 1<span>st</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://stickeraction.com/autoplaysucks/go" title="我很討厭網誌音樂自動播放"><img src="http://stickeraction.com/autoplaysucks/sticker/" alt="我很討厭網誌音樂自動播放" border="0" /></a></p>

<p>這是我當初做 stickeraction 想要弄的議題之一, 就是希望能撲滅音樂自動播放這件事, 誰知道我後來就失憶了 (笑) 不過前幾天發現這張貼紙做的很漂亮, 而且主張很明顯! 超讚的! 大家一起來貼一下吧!!! 拜託嘛 ~&#8221;~</p>

<p>難道沒有人覺得有時候在看正妹相簿的時候, 每點一張照片, 歌就會重新播放一次這件事很反感嗎? XD</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/programming/2568">Stickeraction 全新改版</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-03-01T00:22:00+08:00" pubdate  data-updated="true" >Mar 1<span>st</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://tzangms.com/wp-content/uploads/2010/02/StickerAction.png"><img src="http://tzangms.com/wp-content/uploads/2010/02/StickerAction-303x500.png" alt="" title="StickerAction" width="303" height="500" class="aligncenter size-large wp-image-2569" /></a></p>

<p>其實新版的 <a href="http://stickeraction.com">stickeraction</a> 上線了一個禮拜左右了, 除了版面整個改掉之外, 也從 php + codeigniter 換成 python + django, 換成用最大的好處就是馬上就多了後台可以用 ( 笑 ) 。</p>

<p>另外這次也加了多國語系, 目前有繁體中文、簡體中文以及英文 ( 我想也不會有其他的語系了 XD ), 會依照瀏覽器的語系自動切換, 或者可以從網頁的 footer 來切換語系。</p>

<p>這是我的第二個 django project, 由於第一個是公司的網站, 所以不太能亂搞, 弄個一個自己的以後, 想要衝 trunk 就衝, 完全沒再怕的 XD 至少目前知道 django 1.2 rc 1 用 1.1.1 的設定直接衝上去是沒有問題的 XD</p>

<p>其實沒有管 <a href="http://stickeraction.com">stickeraction</a> 已經好一陣子了, 都靠 <a href="http://mmonit.com/monit/">monit</a> 在幫我重開 <a href="http://www.lighttpd.net/">lighttpd</a>, 可是 php fastcgi 仍舊一直變殭屍一直到把記憶體吃光 Orz</p>

<p>機器仍舊是一台 <a href="http://www.linode.com/">Linode</a> 540MB 的 VPS, deploy 方式是用 apache2 + <a href="http://code.google.com/p/modwsgi/">mod_wsgi</a> 然後一樣是用 <a href="http://pypi.python.org/pypi/virtualenv">virtualenv</a> + <a href="http://pip.openplans.org/">pip</a> 來跑。</p>

<p>剛上線的時候比較慘的是, 目前 stickeraction 的 request 差不多是 30 reqs/sec, 晚上會到 40+ reqs/sec, 所以 Apache 的 KeepAlive 沒有關掉, 一上線就被打掛了, 害我一度以為 apache + python 撐不住, 想說程式白寫的了, 趕快開了 server status 來看才知道是怎麼一回事。</p>

<p>目前看來跑起來都很順, 只是 cpu 較先前吃多了點, 不知道是哪個環節, 因為 lighttpd 換成了 apache, php 換成了 python, 而大部分的 mysql table 也都從 MyISAM 換成了 Innodb, 之後在來試一些東西。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/music/2566">女孩與機器人 預告首部曲</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-02-26T11:50:45+08:00" pubdate  data-updated="true" >Feb 26<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><object width="425" height="344"><param name="movie" value="http://www.youtube.com/v/6TTO_kBNMQQ&hl=zh_TW&fs=1&"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/6TTO_kBNMQQ&hl=zh_TW&fs=1&" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="344"></embed></object>


<p>有 fu, 看就對了!!</p>

<p>看完可以接著去<a href="http://thegirlandtherobots.blogspot.com/">女孩與機器人的 blog</a> 了解一下他們, 另外也可以幫忙貼一下<a href="http://stickeraction.com/tgntr_2nd_ep">女孩與機器人第二張 ep 的串連貼紙</a>喔!!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/django/2564">Django Template Repl</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-02-19T00:00:58+08:00" pubdate  data-updated="true" >Feb 19<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>這個 django template debug app 真的是太酷了!</p>

<object width="560" height="340"><param name="movie" value="http://www.youtube.com/v/XplchLFDlZA&hl=zh_TW&fs=1&"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/XplchLFDlZA&hl=zh_TW&fs=1&" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="560" height="340"></embed></object>


<p><a href="http://github.com/codysoyland/django-template-repl">source 放在 github</a>, 不過通常來說不太會需要對 template 做 debug, 可是真的碰上了奇怪的問題的話, boom! 這個就真的很有用!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/programming/2563">Stickeraction Reborn Soon</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-02-18T01:43:29+08:00" pubdate  data-updated="true" >Feb 18<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.flickr.com/photos/tzangms/4365073697/" title="StickerAction reborn ... soon ... by tzangms, on Flickr"><img src="http://farm5.static.flickr.com/4013/4365073697_955eca0ea0.jpg" width="396" height="500" alt="StickerAction reborn ... soon ..." /></a></p>

<p>除了把 <a href="http://stickeraction.com/">stickeraction</a> 從 <a href="http://php.net">php</a> + <a href="http://codeigniter.com">codeigniter</a> 整個換成 <a href="http://python.org">python</a> + <a href="http://djangoproject.org">django</a> 之外, UI 也整個翻新了, 希望能夠趕快弄好上線, 我就不想管了 (攤)</p>

<p>弄 html + css 真的是比寫 code 還要困難, 而且花時間 ~&#8221;~</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/programming/2562">App Engine Custom Domain</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-02-11T11:13:21+08:00" pubdate  data-updated="true" >Feb 11<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.google.com/apps/intl/zh-TW/business/index.html">google app</a> ( <a href="http://code.google.com/intl/zh-TW/appengine/">engine</a> ) 不支援 naked domain 實在是太遺憾了, 好像是後來才拿掉支援的。 這樣一來就一定得用 <a href="http://www.myaudiocast.com">www.myaudiocast.com</a>, 而不能用 <a href="http://myaudiocast.com">myaudiocast.com</a>。</p>

<p>所以也只能透過 domain forwarding 來把 <a href="http://myaudiocast.com">myaudiocast.com</a> 轉到 <a href="http://www.myaudiocast.com">www.myaudiocast.com</a> 這個方法了, 真是遺憾 ~&#8221;~</p>

<p>只好在我的 Godaddy 打開 forwarding, redirect permanently 到 <a href="http://www.myaudiocast.com">www.myaudiocast.com</a>, 然後修改 @ 的 ARecord, 指到 64.202.189.170 如下</p>

<p>ARecord @   64.202.189.170</p>

<p>以上這 ARecord 是 godaddy 的說明上寫的, 可是有點難找, 所以才寫出來記錄一下。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/myaudiocast/2559">MyAudioCast 發佈 Podcast 到 iTunes Store</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-02-10T23:26:21+08:00" pubdate  data-updated="true" >Feb 10<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.myaudiocast.com/">MyAudioCast</a> 現在會產生 100% 符合 iTunes Podcast 的 RSS Feed ( 好啦 98% ), 所以現在只要在上傳節目後, 把必要的 Podcast 資訊填上, 就可以依照 <a href="http://www.myaudiocast.com/">MyAudioCast</a> 管理後台的發佈指示發送到 Podcast, 接著就等 apple 的回信說你通過囉! :D</p>

<p>之後就看到像可以上面那張圖, 在 iTunes Store ( US ) 看到你的 Podcast 出現。 沒錯, 就是 US, 沒有 TW 這回事 XD</p>

<p>其實沒啥, 可是感覺很不賴 XD</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/programming/2558">在 App Engine 上用 Urlfetch 解短網址</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-02-08T00:53:08+08:00" pubdate  data-updated="true" >Feb 8<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>昨天在寫一個程式, 功能是在把 twitter 上帶有 mp3 連結的訊息, 轉成 podcast 好讓我可以用 iTunes 訂閱, 自動下載 XD 推特那一段就直接用了 <a href="http://search.twitter.com/">twitter search</a> 產生的 json, 然後 mp3 的連結都是 tinyurl 產生的短網址, 直覺我就透過了 <a href="http://longurl.org/">longurl</a> 的 api 來回復短網址。</p>

<p>誰知道 <a href="http://longurl.org/api">longurl api</a> 常 request 失敗, 也許可能是因為連續的 request 造成的。後來就突然想到了, 反正 header 都會帶有轉址的原網址吧, 所以就用 <a href="http://code.google.com/intl/zh-TW/appengine/docs/python/urlfetch/">urlfetch</a> 單純只抓 header, 然後 parse header 抓出來正常的網址就好啦~ 誰知道看了一下 urlfetch 的文件有居然 final_url 這個 method, 噗, 結果解短網址就變得超簡單。</p>

<pre><code>result = urlfetch.fetch(tinyurl, method=urlfetch.HEAD)
if result.status_code == 200:
    url = result.final_url
</code></pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/programming/2557">App Engine 405 Method Not Allowed</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-02-07T19:54:21+08:00" pubdate  data-updated="true" >Feb 7<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>不太清楚為何<a href="http://code.google.com/intl/zh-TW/appengine/docs/python/tools/webapp/">webapp</a> 為何沒有 implement HEAD method, 所以一開始在 <a href="http://myaudiocast.appspot.com/">MyAudioCast</a> 的 DashBoard 就常看到一些錯誤, 多是一些 <a href="http://en.wikipedia.org/wiki/Web_crawler">web crawler</a>, 但卻都是 405 Method Not Allowed 的錯誤訊息, 用 curl -I 來測也是得到相同的回應, 本來不以為意, 後來為了要讓 MyAudioCast 上面的 Podcast 可以 submit 到 iTunes store, 卻也得到 405 的錯誤訊息, 無法 submit, 才覺得這事情有點大條 XD</p>

<p>google 之後找到一篇寫到說, 用 app engine 開發的網站無法 digg, 就是因為 405 這個問題, 因為要新增網址到 digg 的時候 digg 會用 HEAD method 來確認網頁是存在的, 所以說先前 Dashboard 上看到的 web crawler 也會先用 HEAD 來檢查網頁是否存在, 這麼一來只要是 HEAD method 都回 405 Method Not Allowed 的話, 那機器人不就都不來了嗎?</p>

<p>不過這問題其實很好解決, 幸好這次在開發的時候有先寫一個 RequestHandler 來繼承 webapp.RequestHandler 所以直接在 RequestHandler 增加一個 head method 就可以解決這個了。</p>

<pre><code>def head(self, *args):
    pass
</code></pre>


<p>最簡單的就是這樣 XD 不過不知道是否改為執行 get method 然後把 content 去掉只留 header 這樣會不會比較好 :p</p>
</div>
  
  


    </article>
  
  <nav class="pagination">
    <div>
      
        <a class="prev" href="/page/12/">&larr; Older</a>
      
      <a href="/blog/archives">Blog Archives</a>
      
      <a class="next" href="/page/10/">Newer &rarr;</a>
      
    </div>
  </nav>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/10/15/appengine-so-expensive/">App Engine 好貴</a>
      </li>
    
      <li class="post">
        <a href="/2011/10/14/save-myaudiocast/">拯救 MyAudioCast</a>
      </li>
    
      <li class="post">
        <a href="/2011/10/13/ios5-release/">iOS5 release</a>
      </li>
    
      <li class="post">
        <a href="/2011/10/09/from-blogofile-to-octopress/">From blogofile to octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/new-tumblr">tumblr 開張 (tzang.ms)</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/tzangms">@tzangms</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tzangms',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("tzangms", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/tzangms" class="twitter-follow-button" data-width="208px" data-show-count="true">Follow @tzangms</a>
  
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - tzangms -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
    (function () {
      var disqus_shortname = 'tzangms';
      
        
        var disqus_script = 'count.js'
      

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-418467-7']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>





</body>
</html>
